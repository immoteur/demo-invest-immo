services:
  web:
    build:
      context: .
    container_name: invest_immo_demo
    restart: unless-stopped
    environment:
      NODE_ENV: production
      NEXT_TELEMETRY_DISABLED: 1
      IMMOTEUR_API_KEY: ${IMMOTEUR_API_KEY:?IMMOTEUR_API_KEY is required}
      IMMOTEUR_API_BASE_URL: ${IMMOTEUR_API_BASE_URL:-https://api.immoteur.com/public/v1}
      PORT: 3000
    ports:
      - '${APP_BIND_IP:-127.0.0.1}:${APP_HOST_PORT:-3002}:3000'
    read_only: true
    tmpfs:
      - /tmp
      - /app/.next/cache
    cap_drop:
      - ALL
    security_opt:
      - no-new-privileges:true
    healthcheck:
      test:
        [
          'CMD-SHELL',
          'node -e "fetch(''http://localhost:3000'').then(r=>process.exit(r.ok?0:1)).catch(()=>process.exit(1))"',
        ]
      interval: 10s
      timeout: 3s
      retries: 10
